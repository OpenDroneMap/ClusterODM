services:

  nodeodm-1:
    image: opendronemap/nodeodm:3.5.5
    container_name: nodeodm-1
    restart: on-failure:10

  clusterodm:
    image: opendronemap/clusterodm:2.0.0
    container_name: clusterodm
    volumes:
      - ./data/nodes.json:/var/www/data/nodes.json
    restart: on-failure:10
    depends_on:
      - nodeodm-1

  tests:
    image: opendronemap/clusterodm:2.0.0
    container_name: clusterodm-tests
    volumes:
      - ../libs:/var/www/libs
      - ../tests:/var/www/tests
    restart: on-failure:10
    depends_on:
      - clusterodm
    # Override entrypoint to run tests
    entrypoint: npm run test
